
## ‚öôÔ∏è NGFW Mode: Profile-based vs. Policy-based

This is a high-level **System Operation Setting** that changes the entire logic of how you build firewall policies. You must choose one mode for the entire FortiGate (or VDOM).

---
![[Pasted image 20251103173810.png]]
### 1. Profile-based NGFW Mode (The Traditional Mode)

This is the classic, most common mode for FortiGate.

- **Simple Definition:** In this mode, security features (like Web Filter, AntiVirus, and App Control) are configured as separate **Security Profiles** first. You then **attach** these profiles to your firewall policies.
    
- **Mechanism:** It separates the "security rules" (Profiles) from the "traffic rules" (Policies). This allows you to create one complex Web Filter profile and reuse it across 10 different firewall policies.
    
- **Key Features (from your text):**
    
    - **Flexibility:** This is the most flexible mode.
        
    - **NAT:** You can use _either_ per-policy NAT _or_ **Central NAT**.
        
    - **Inspection:** You can choose _either_ **Flow-based** _or_ **Proxy-based** inspection for each individual policy.
        

---

### 2. Policy-based NGFW Mode (The Streamlined Mode)

This is a newer, simplified mode designed to feel more like other firewall brands.

- **Simple Definition:** This mode lets you define **Application Control** and **Web Filtering** (URL categories) _directly inside_ the firewall policy, without creating separate profiles for them.
    
- **Mechanism:** It combines the traffic rules and the security rules into a single, centralized policy entry. (Note: Other profiles like AntiVirus still need to be attached separately).
    
- **Key Features (from your text):**
    
    - **Simplicity:** Easier to manage for simpler networks or for administrators migrating from other platforms.
        
    - **NAT:** _Forces_ the use of **Central NAT**. You lose the option for per-policy NAT.
        
    - **Inspection:** _Forces_ the use of **Flow-based** inspection. You lose the ability to select Proxy-based inspection.
        

---

#### ‚öñÔ∏è At-a-Glance Comparison

| **Parameter**         | **Profile-based Mode (Traditional)**                                               | **Policy-based Mode (Streamlined)**                                  |
| --------------------- | ---------------------------------------------------------------------------------- | -------------------------------------------------------------------- |
| **App/Web Control**   | Configured in separate **Security Profiles** and attached to policies.             | Configured **directly inside** the firewall policy.                  |
| **NAT Configuration** | **Flexible:** Supports both Per-Policy NAT and Central NAT.                        | **Forced:** Only supports **Central NAT**.                           |
| **Inspection Mode**   | **Flexible:** Supports both **Flow-based** and **Proxy-based** inspection.         | **Forced:** Only supports **Flow-based** inspection.                 |
| **üß≠ Best For...**    | Complex networks needing granular control, diverse NAT, or Proxy-based inspection. | Simpler networks or admins wanting a single, all-in-one policy view. |

## ‚öôÔ∏è Inspection Modes: Flow vs. Proxy

This is the most fundamental choice for a Firewall Policy. The **Inspection mode** defines the _engine_ the FortiGate uses to analyze traffic. The mode you select (Flow or Proxy) dictates the performance, security level, and available features for your Security Profiles (like the Web Filter).


---
![[Pasted image 20251103173553.png]]
### 1. Flow-based

This is the default, high-speed inspection method. It is often called "Profile-based" because it is designed to efficiently apply security _profiles_.

- **Simple Definition:** Flow-based inspection checks packets _as they flow_ through the firewall, without buffering the entire file or web page.
    
- **Mechanism:** It acts like a security guard at a checkpoint, scanning each packet for threats (virus signatures, web categories) in a single pass. It is extremely fast and has a low impact on network performance.
    
- **Impact on Web Filter:** This mode is perfect for high-speed **Web Filtering** based on categories, blocking known malicious sites, and basic keyword filtering. It scans the web page as it loads.
    

---

### 2. Proxy-based

This is a more thorough, feature-rich inspection method that acts as a true intermediary (a proxy) between the user and the destination.

- **Simple Definition:** The firewall terminates the connection from the client, fully inspects the content, and then builds a new, separate connection to the server.
    
- **Mechanism:** It acts like a secure mailroom. The FortiGate receives the _entire_ package (e.g., a full file download or complete web page), opens it, scans it for any threats, and then re-packages it and sends it to the user.
    
- **Impact on Web Filter:** This mode enables the most powerful **Web Filtering** features, such as:
    
    - Need High Performance and capabilities
    
    - Advanced content buffering (scans the _whole_ file before delivery) .
        
    - More reliable content-aware filtering.
        
    - Deeper inspection for features like Data Loss Prevention (DLP).
        
    - This is the mode you enabled with the CLI command ==`set inspection-mode proxy`==.



## üåê Web Rating Overrides

![[Pasted image 20251103175955.png]]

This feature lets you manually disagree with FortiGate's built-in web filter.

Sometimes, the FortiGuard service (which automatically categorizes all websites) assigns a category you don't like. For example, the image shows that FortiGuard has categorized `youtube.com` as **"Bandwidth Consuming"**.

If your company policy blocks the "Bandwidth Consuming" category to save data, but you still want to allow access to YouTube, you can use an override.

In this example, the administrator is overriding FortiGuard's decision. They are manually re-categorizing `youtube.com` as **"General Interest - Personal"**. Now, when the web filter checks the site, it will see the new, custom category, which will likely be allowed by the company's security policy. It's simply a way to make specific exceptions to your broad, category-based rules.

## üö¶ HTTP Inspection Order (Web Filter Flow)

![[Pasted image 20251103183737.png]]
This diagram shows the precise, step-by-step process the FortiGate **Web Filter** follows to decide whether to **Allow** or **Block** a user's request to access a specific **URL** (website). The checks are always performed in this specific order.

### Inspection Flow

1. **Static URL Filter Check:** When a user requests a URL, the FortiGate _first_ checks the **Static URL Filter**. This is the manual list where administrators explicitly add websites to **Block**, **Allow**, or **Exempt**.
    
    - If the site is on the **Block** list, the user sees a **Block Page**, and the process stops.
        
    - If the site is on the **Exempt** list, the firewall **skips all other checks**, and the user is immediately allowed to **Display Page**.
        
    - If the site is not on these lists, it moves to the next check.
        
2. **FortiGuard Category Filter Check:** Next, the firewall checks the website's dynamic category (e.g., "Social Media," "Gambling") against the active **FortiGuard Category Filter** profile.
    
    - If the category is set to **Block**, the user sees a **Block Page**, and the process stops.
        
    - If the category is **Allowed** or **Monitored**, it moves to the final check.
        
3. **Advanced Filters Check:** Finally, the request is checked against any **Advanced Filters**, such as keyword filtering, file type blocking, or other advanced settings.
    
    - If it matches a **Block** rule, the user sees a **Block Page**.
        
    - If it passes this final check, the user is successfully allowed to **Display Page**.
## Commands:

1.==`config firewall policy`== is used for **entering the configuration mode** for the FortiGate's **firewall policies**.

![[Pasted image 20251103155634.png]]



2.==`set inspection-mode proxy`== is used for **setting the policy's inspection method to 'Proxy-based' instead of the default 'Flow-based'**.

![[Pasted image 20251103155958.png]]




